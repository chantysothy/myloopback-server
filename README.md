# My Loopback Server

This is a sample Loopback server for testing/demonstrating purposes.

### Features
+ allow user to log in through username/password OR Facebook Token (mostly used by mobile clients)
+ more coming soon

### Related projects (coming soon)
+ iOS Client
+ Android Client

## Installation
+ Clone project from github
+ `npm install`
+ get your Facebook cliendID and SecretID using Facebook Developer Dashboard
+ rename or copy `providers.json.dist` to `providers.json`
+ edit `providers.json` and provide your ids.
+ Datasources are set to "memory connector", with file output. This is just for testing/debugging, feel free to edit `server/datasource` to suit your needs.
I personally use Postrgesql with success.
+ type `node bin/automigrate_all` into your project directory to load sample data.

## About passport-facebook-connector

Use Facebook SDK to get a token linked to a user and your app. Then use GET route `{server}/auth/facebook-token/callback?access_token={long_term_token_provided_by_facebook}` to log in to your Loopback server.

If this is the first time this Facebook Account is used in this application, a new User is created, with a linked 3re-party Identity. Otherwise, the previously created account is, of course, returned.

I use custom route to return both user account and Identity (= Facebook account) in one JSON.

All the magic is done by [loopback-connector-passport](https://github.com/strongloop/loopback-component-passport) and [passport-facebook-token](https://github.com/drudge/passport-facebook-token). See their own documentation for more informations.Latest Passport version (2.1) resolves most of usual bugs (identity duplication, error while fetching user, ...), so be sure to have the latest version !

I use a custom boot script (`server/boot/facebook-token-auth.js`) to add configuration, routes and a little glue without modifying server.js.

Passport send his response with cookie, so don't disable cookie parser even if you don't need it for your client apps.

The project is generated by [LoopBack](http://loopback.io). But you knew it, of course.
